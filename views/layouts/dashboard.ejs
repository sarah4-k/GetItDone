<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/PageStyle.css">
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
</head>

<body>
<%- include('../partials/nav_dashboard') %> 

<div class="container my-5">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="mb-0">Your Tasks</h2>
    <a href="/task/add" class="btn rounded-circle add-task-btn" title="Add Task">+</a>
  </div>

<% if (typeof message !== 'undefined') { %>
<div class="motivational-message my-4 d-flex align-items-center justify-content-between position-relative">
  <div class="message-icon">ðŸ’¡</div>
  <div class="flex-grow-1 text-center message-text">
    <%= message.text %>
  </div>
  <img src="<%= message.image %>" alt="Motivational" style="height: 70px; width: 70px; border-radius: 12px;">
  <button class="close-btn" onclick="this.parentElement.style.display='none'">Ã—</button>
</div>
<% } %>

  <!-- Task list -->
  <ul class="mt-4">
    <% tasks.forEach(task => { %>
    <li class="mb-3">
      <strong><%= task.title %></strong>
      â€” <%= task.category %> â€” <%= task.priority === 1 ? "High" :
      task.priority === 2 ? "Medium" : "Low" %> â€” due: <%= task.dueDate ?
      task.dueDate.toDateString() : "No date" %>

      <form
        method="POST"
        action="/task/<%= task._id %>/delete"
        style="display: inline"
      >
        <button type="submit" class="btn btn-danger btn-sm ms-2">Delete</button>
      </form>
      <a href="/task/<%= task._id %>/edit" class="btn btn-warning btn-sm ms-2">Edit</a>
    </li>
    <% }) %>
  </ul>
</div>


<%- include('../partials/footer') %> 
<script>
  setTimeout(() => {
    const msgBox = document.querySelector('.motivational-message');
    if (msgBox) msgBox.style.display = 'none';
  }, 10000); 

  setTimeout(() => {
    fetch('/api/random-message')
      .then(res => res.json())
      .then(data => {
        const msgBox = document.querySelector('.motivational-message');
        const msgText = document.querySelector('.motivational-message .message-text');
        const msgImage = document.querySelector('.motivational-message img');

        if (msgBox && msgText) {
          msgText.textContent = data.message;
          msgImage.src = data.message.image;
          msgBox.style.display = 'flex'; 
        }
      });
  }, 300000); 
</script>
</body>
</html>
