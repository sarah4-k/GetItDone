<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/PageStyle.css">
</head>

<body>
<%- include('../partials/nav_dashboard') %> 

<div class="container my-5">
  <h2>Your Tasks</h2>

  <form method="POST" action="/task" class="mt-3">
    <div class="mb-3">
      <input type="text" name="title" placeholder="Task title" required class="form-control" />
    </div>
    <div class="mb-3">
      <input type="text" name="description" placeholder="Description" class="form-control" />
    </div>

    <!-- Category dropdown + input -->
    <div class="mb-3">
      <label for="categoryDropdown" class="form-label">Category</label>
      <select
        id="categoryDropdown"
        onchange="handleCategoryChange()"
        class="form-control category-select"
      >
        <% categories.forEach(cat => { %>
        <option value="<%= cat %>"><%= cat %></option>
        <% }) %>
        <option value="other">Other...</option>
      </select>

      <!-- Hidden input field for custom category -->
      <input
        type="text"
        name="category"
        id="customCategory"
        placeholder="Write a category..."
        class="form-control mt-2"
        style="display: none"
      />
    </div>

    <!-- Due date -->
    <div class="mb-3">
      <input type="date" name="dueDate" class="form-control" />
    </div>

    <!-- Priority dropdown -->
    <div class="mb-3">
      <select name="priority" required class="form-control">
        <option value="1">High</option>
        <option value="2" selected>Medium</option>
        <option value="3">Low</option>
      </select>
    </div>

    <button type="submit" class="btn btn-primary">Add Task</button>
  </form>

  <!-- Task list -->
  <ul class="mt-4">
    <% tasks.forEach(task => { %>
    <li class="mb-3">
      <strong><%= task.title %></strong>
      — <%= task.category %> — <%= task.priority === 1 ? "High" :
      task.priority === 2 ? "Medium" : "Low" %> — due: <%= task.dueDate ?
      task.dueDate.toDateString() : "No date" %>

      <form
        method="POST"
        action="/task/<%= task._id %>/delete"
        style="display: inline"
      >
        <button type="submit" class="btn btn-danger btn-sm ms-2">Delete</button>
      </form>
      <a href="/task/<%= task._id %>/edit" class="btn btn-warning btn-sm ms-2">Edit</a>
    </li>
    <% }) %>
  </ul>
</div>

    <script>
      function handleCategoryChange() {
        const dropdown = document.getElementById("categoryDropdown");
        const input = document.getElementById("customCategory");
     
        if (dropdown.value === "other") {
          input.style.display = "block";
          input.value = ""; // clear if previously auto-filled
          input.focus();
        } else {
          input.style.display = "none";
          input.value = dropdown.value; // auto-fill the chosen value
        }
      }
     
      // Call it on load in case a value is pre-selected
      handleCategoryChange();
    </script>

<%- include('../partials/footer') %> 
</body>
</html>
